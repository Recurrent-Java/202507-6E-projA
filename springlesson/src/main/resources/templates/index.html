<!DOCTYPE html>
<!-- Thymeleafを使用するための記述 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <div th:replace="~{comlayout/base :: meta}"></div>
  <div th:replace="~{comlayout/base :: styles}"></div>
  
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>

  <link rel="stylesheet" th:href="@{/css/top.css}">
  <title>トップページ</title>
</head>

<body>
  <div th:replace="~{comlayout/base :: header}"></div>

  <main>
    <!-- メインビジュアル -->
    <section class="hero">
        <div><img th:src="@{/images/top1.png}" alt="スイーツ1"></div>
        <div><img th:src="@{/images/top2.png}" alt="スイーツ2"></div>
        <div><img th:src="@{/images/top3.png}" alt="スイーツ3"></div>
    </section>

    <!-- 検索 -->
	<section class="search">
	  <form th:action="@{/}" method="get">
	    <input type="text" name="keyword" placeholder="商品を検索" th:value="${keyword}">
	    <button type="submit">検索</button>
	  </form>
	</section>

    <!-- カテゴリー -->
    <section class="category">
      <form id="categoryForm" th:action="@{/}" method="get">
        <ul>
          <li>
            <label>
              <input type="checkbox" name="catIds" value="0" 
                     th:checked="${selectedCatIds == null || selectedCatIds.isEmpty()}" 
                     onchange="handleCategoryChange(this)">
              すべて
            </label>
          </li>

          <li th:each="cat : ${categoryList}">
            <label>
              <input type="checkbox" name="catIds" 
                     th:value="${cat.catId}" 
                     th:checked="${selectedCatIds != null && selectedCatIds.contains(cat.catId)}" 
                     onchange="handleCategoryChange(this)">
              <span th:text="${cat.catName}">カテゴリー名</span>
            </label>
          </li>
        </ul>
      </form>
    </section>

    <!-- 商品一覧 -->
    <section class="products">
      <h2>商品一覧</h2>

      <div id="productContainer">
        <div class="product-list" 
             th:fragment="product-list-fragment">
             <div class="product-card" th:each="product : ${products}">
                <a th:href="@{/product/products/{id}(id=${product?.productId})}">
                    <img th:src="@{${product.imagePath != null ? product.imagePath : '/images/noimage.png'}}" alt="">
                    <p class="name" th:text="${product.productName}"></p>
                    <p class="price">¥<span th:text="${#numbers.formatInteger(product.price, 1, 'COMMA')}"></span></p>
                </a>
             </div>
        </div>
    </section>
  </main>
  <div th:replace="~{comlayout/base :: footer}"></div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    
  <script>
      $(document).ready(function(){
        $('.hero').slick({
          autoplay: true,       /* 自動再生 */
          autoplaySpeed: 3000,  /* 3秒ごとに次へ */
          dots: true,           /* 下に丸いドットを表示 */
          arrows: false,        /* 左右の矢印は一旦なし（デザインに合わせやすい） */
          fade: true,           /* ふわっと切り替える */
          speed: 1000           /* 切り替えにかける時間（1秒） */
        });
      });
      
      function handleCategoryChange(checkbox) {
        const form = document.getElementById('categoryForm');
        const allCheckbox = form.querySelector('input[value="0"]');
        const categoryCheckboxes = form.querySelectorAll('input[name="catIds"]:not([value="0"])');
        
        if (checkbox.value === '0') {
          // 「すべて」がチェックされた場合、他のチェックを外す
          if (checkbox.checked) {
            categoryCheckboxes.forEach(cb => cb.checked = false);
          }
        } else {
          // 個別カテゴリーがチェックされた場合、「すべて」のチェックを外す
          if (checkbox.checked) {
            allCheckbox.checked = false;
          }
          
          // すべてのカテゴリーチェックが外れた場合、「すべて」をチェック
          const anyChecked = Array.from(categoryCheckboxes).some(cb => cb.checked);
          if (!anyChecked) {
            allCheckbox.checked = true;
          }
        }
        
        // フォーム送信
        form.submit();
      }
   </script>
  
</body>

</html>